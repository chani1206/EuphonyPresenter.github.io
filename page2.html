<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>問卷調查</title>
</head>
<body>
    <h1>問卷調查</h1>
    <audio id="audioPlayer" controls></audio>
    <br>
    <button onclick="playNext()">播放下一段音頻</button>
    <br><br>

    <!-- 使用隱藏的iframe來提交表單 -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    <!-- 問卷表單 -->
    <form id="questionnaireForm" method="POST" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLScS5AL3M0T76yQR30HlUzidZeomwvihhv2JthqwnswUGDUi0w/formResponse" target="hidden_iframe" onsubmit="submitted=true;">
        <input type="hidden" name="entry.1077065053" id="nickname">
        <input type="hidden" name="entry.1173466811" id="age">
        <input type="hidden" name="entry.373069006" id="profession">
        <input type="hidden" name="entry.1630063381" id="musicTraining">
        <input type="hidden" name="entry.367896919" id="audioNumber">
        <input type="hidden" name="entry.1898504299" id="timeTaken">

        <label for="feeling">感受量表（-5 到 5）：</label>
        <input type="number" name="entry.1295919402" id="feeling" min="-5" max="5" required>
        <br><br>

        <label for="arousal">感覺喚起量表（1 到 6）：</label>
        <input type="number" name="entry.557372817" id="arousal" min="1" max="6" required>
        <br><br>

        <label for="euphony">和諧度評分（0 到 10）：</label>
        <input type="number" name="entry.1179291034" id="euphony" min="0" max="10" required>
        <br><br>

        <label for="investment">投資意向評分（0 到 10）：</label>
        <input type="number" name="entry.1743600620" id="investment" min="0" max="10" required>
        <br><br>

        <input type="submit" value="提交">
    </form>

    <script>
        let submitted = false;

        // 從第一頁獲取資料
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById("nickname").value = urlParams.get('nickname');
        document.getElementById("age").value = urlParams.get('age');
        document.getElementById("profession").value = urlParams.get('profession');
        document.getElementById("musicTraining").value = urlParams.has('musicTraining') ? '是' : '否';

        const audioFiles = [
            {url: "https://docs.google.com/uc?export=open&id=1qYLmEIF4QHpPvsGFMiJzIZB4ewj32Com", originalIndex: 1},
            {url: "https://docs.google.com/uc?export=open&id=1Bm6EiLHPnTWyLkBmYJKmDFl05cCzDkeR", originalIndex: 2},
            {url: "https://docs.google.com/uc?export=open&id=1fw_MnhrEOZ_GRrMeipHC71Same32KyCH", originalIndex: 3},
            {url: "https://docs.google.com/uc?export=open&id=1CFisXIRiQxzYuKiVsXSbtc8WR4PWT43k", originalIndex: 4},
            {url: "https://docs.google.com/uc?export=open&id=1K4lyMsVblbWfCF2aJanaVaxxUhRB2Dn7", originalIndex: 5}
            // 在此處添加所有 75 個音頻檔案鏈接及其原始索引
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let shuffledAudioFiles = shuffleArray(audioFiles);
        let currentIndex = 0;
        let startTime;

        function playNext() {
            if (currentIndex < shuffledAudioFiles.length) {
                let audioData = shuffledAudioFiles[currentIndex];
                document.getElementById("audioPlayer").src = audioData.url;
                document.getElementById("audioPlayer").play();
                
                document.getElementById("audioNumber").value = audioData.originalIndex; // 設置原始音頻編號
                startTime = new Date(); // 記錄開始時間
                
                currentIndex++;
            } else {
                alert("您已經播放完所有音頻檔案。");
            }
        }

        document.getElementById("questionnaireForm").onsubmit = function(event) {
            let endTime = new Date(); // 記錄結束時間
            let timeTaken = (endTime - startTime) / 1000; // 計算耗時（秒）
            document.getElementById("timeTaken").value = timeTaken;

            if (submitted) {
                event.preventDefault();
                document.getElementById("questionnaireForm").reset();
                playNext();
                submitted = false;
            } else {
                submitted = true;
            }
        };
    </script>
</body>
</html>
